# SAMap -- version 0.1.0
The SAMap algorithm.

This demonstration was run on zebrafish and xenopus cell atlases, both of which were subsampled to 10k cells to reduce file sizes.

## Requirements
SAMap was developed and tested in an Anaconda python environment with the following dependencies:
 - `sam-algorithm==0.7.5`
 - `scanpy==1.5.1`
 - `hnswlib==0.3.4`
 - `matplotlib==3.1.3`


## Installation

Download Anacodna from here:
    https://www.anaconda.com/download/

Create and activate a new environment with python3.6 as follows:
```
conda create -n environment_name python=3.6
conda activate environment_name
```
Having activated the environment, install SAMap like so:

```
cd samap_directory
pip install .
```

NCBI BLAST must be installed for the commandline. Download version 2.1.0 here for LINUX/UNIX systems (here)[ftp://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/2.9.0/ncbi-blast-2.9.0+-x64-linux.tar.gz]. Unpack the tarball with:
```
tar -xzvf ncbi-blast-2.9.0+-x64-linux.tar.gz
```
Add the bin files to your path with.
```
echo "export PATH=\"$PATH:/your/directory/ncbi-blast-2.9.0+/bin\"" >> ~/.bashrc
source ~/.bashrc
```
*Installation time should take no more than 5 minutes.*

## Running the SAMap demonstration

First, we must map the transcriptomes to generate the homology graph. Because this is a computationally-intensive step, we already provided the output files necessary for downstream analyses in `transcriptomes/maps`.

Navigate to the `transcriptomes` directory:
```
cd transcriptomes
```

Run the mapping bash script:
```
bash map.sh
```
Depending on the number of cores available on your machine and the size of the input transcriptomes, this may take up to around 4 hours.

Navigate back to the root directory and run the `run_demo.py` script (make sure your anaconda environment is activated).

```
python run_demo.py
```

*SAMap should run in around 10 minutes for this demonstration.*

## Outputs
The outputs for this demonstration are located in the `output` folder. Example outputs generated by the demo are in output/zexe_example.

We generate
 - a UMAP projection of the combined species manifold (`output/zexe/umap.png`). Red is frog and blue is fish.
 - an `AnnData` object containing the UMAP projection coordinates, cell metadata, gene pairs, etc (`output/zexe/st_zexe.h5ad`).
 - a tab-delimited table with all homologous gene pairs with positive expression correlation (`output/zexe/gene_pairs_correlation.tsv`)
 - a tab-delimited table with the mapping scores between zebrafish and xenopus cell types (`output/zexe_celltype_mapping_scores.tsv`)
